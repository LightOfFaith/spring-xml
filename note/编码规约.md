
# 异常和日志

*   尽可能携带完整的上下文信息，比如出错原因，出错的机器地址，调用对方的地址。
*   尽量将直接原因写在最前面，所有上下文信息，在原因后用键值对显示。
*   抛出异常的地方不用打印日志，由最终处理异常者决定打印日志的级别，吃掉异常必需打印日志。
*   打印 ERROR 日志表示需要报警，打印 WARN 日志表示可以自动恢复，打印 INFO 表示正常信息或完全不影响运行。
*   建议应用方在监控中心配置 ERROR 日志实时报警，WARN 日志每周汇总发送通知。
*   谨慎地记录日志。生产环境禁止输出 debug 日志；有选择地输出 info 日志；如果使
用 warn 来记录刚上线时的业务行为信息，一定要注意日志输出量的问题，避免把服务器磁盘
撑爆，并记得及时删除这些观察日志。
*   可以使用 warn 日志级别来记录用户输入参数错误的情况，避免用户投诉时，无所适
从。如非必要，请不要在此场景打出 error 级别，避免频繁报警。



# 单元和集成测试

*   单元测试统一用 JUnit 和 EasyMock，集成测试用 TestNG，数据库测试用 DBUnit。
*   保持单元测试用例的运行速度，不要将性能和大的集成用例放在单元测试中。
*   保持单元测试的每个用例都用 try...finally 或 tearDown 释放资源。
*   减少 while 循环等待结果的测试用例，对定时器和网络的测试，用以将定时器中的逻辑抽为方法测试。

# 模块与分包

*   基于复用度分包，总是一起使用的放在同一包下，将接口和基类分成独立模块，大的实现也使用独立模块。
*   所有接口都放在模块的根包下，基类放在 support 子包下，不同实现用放在以扩展点名字命名的子包下。
*   尽量保持子包依赖父包，而不要反向。











